<!DOCTYPE html>
<html>
<head>
    <title>Admin Panel - RayChat</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        .admin-section { margin: 20px; }
        .admin-table { width: 100%; border-collapse: collapse; }
        .admin-table th, .admin-table td { border: 1px solid #ccc; padding: 8px; }
        .admin-table th { background: #f2f2f2; }
    </style>
</head>
<body>
    <div class="admin-section">
        <h2>👑 Admin Panel</h2>
        <p>Welcome, {{ session.username }}</p>
        <a href="/">← Back to Chat</a>

        <h3>📋 Registered Users</h3>
        <table class="admin-table">
            <tr><th>Username</th></tr>
            {% for user in users %}
                <tr><td>{{ user.username }}</td></tr>
            {% endfor %}
        </table>

        <h3>💬 Recent Messages</h3>
        <table class="admin-table">
            <tr><th>User</th><th>Message</th></tr>
            {% for msg in messages %}
                <tr>
                    <td>{{ msg.username }}</td>
                    <td>{{ msg.message }}</td>
                </tr>
            {% endfor %}
        </table>

        <form method="post" action="/admin/clear">
            <button type="submit" style="margin-top: 15px;">🧹 Clear All Chat Messages</button>
        </form>
    </div>
</body>
<h3>🟢 Active Sessions</h3>
<table class="admin-table" id="activeSessionsTable">
    <tr><th>Username</th><th>Connected For</th></tr>
</table>

<script>
async function loadActiveSessions() {
    const res = await fetch('/admin/active_sessions');
    const data = await res.json();
    const table = document.getElementById('activeSessionsTable');
    
    // Clear old rows except header
    while(table.rows.length > 1) {
        table.deleteRow(1);
    }

    data.users.forEach(user => {
        const row = table.insertRow();
        row.insertCell(0).innerText = user.username;
        row.insertCell(1).innerText = user.connected_for;
    });
}

// Refresh every 10 seconds
loadActiveSessions();
setInterval(loadActiveSessions, 10000);
</script>
</html>
